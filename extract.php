<?php

$cities = [
    "3" => 'Islamabad',
    "2" => 'Karachi',
    "1" => 'Lahore',
    "41" => 'Rawalpindi',
    "385" => 'Abbottabad',
    "10594" => 'Abdul Hakim',
    "12360" => 'Ahmedpur East',
    "18624" => 'Ali Masjid',
    "10242" => 'Alipur',
    "9517" => 'Arifwala',
    "1763" => 'Astore',
    "1233" => 'Attock',
    "1761" => 'Awaran',
    "8857" => 'Badin',
    "966" => 'Bagh',
    "557" => 'Bahawalnagar',
    "23" => 'Bahawalpur',
    "14226" => 'Balakot',
    "1735" => 'Bannu',
    "13977" => 'Barnala',
    "13808" => 'Batkhela',
    "17727" => 'Battagram',
    "1720" => 'Bhakkar',
    "11142" => 'Bhalwal',
    "1749" => 'Bhimber',
    "11286" => 'Buner',
    "1059" => 'Burewala',
    "1747" => 'Chaghi',
    "751" => 'Chakwal',
    "11420" => 'Charsadda',
    "8860" => 'Chichawatni',
    "17728" => 'Chilas',
    "1469" => 'Chiniot',
    "17729" => 'Chishtian',
    "10512" => 'Chishtian Sharif',
    "1731" => 'Chitral',
    "14284" => 'Choa Saidan Shah',
    "1061" => 'Chunian',
    "1727" => 'Dadu',
    "11967" => 'Daharki',
    "1509" => 'Daska',
    "13599" => 'Daur',
    "9178" => 'Depalpur',
    "26" => 'Dera Ghazi Khan',
    "8244" => 'Dera Ismail Khan',
    "10645" => 'Dijkot',
    "12718" => 'Dina',
    "14195" => 'Dobian',
    "8474" => 'Duniya Pur',
    "1737" => 'FATA',
    "16" => 'Faisalabad',
    "1293" => 'Fateh Jang',
    "10894" => 'Gaarho',
    "11915" => 'Gadoon',
    "8119" => 'Galyat',
    "18016" => 'Gambat',
    "13272" => 'Ghakhar',
    "17730" => 'Ghanche',
    "636" => 'Gharo',
    "17768" => 'Ghizar',
    "8810" => 'Ghotki',
    "1753" => 'Gilgit',
    "10281" => 'Gojra',
    "8338" => 'Gujar Khan',
    "327" => 'Gujranwala',
    "20" => 'Gujrat',
    "389" => 'Gwadar',
    "1714" => 'Hafizabad',
    "13607" => 'Hala',
    "11739" => 'Hangu',
    "11634" => 'Harappa',
    "1048" => 'Haripur',
    "1152" => 'Haroonabad',
    "9687" => 'Hasilpur',
    "399" => 'Hassan Abdal',
    "10402" => 'Haveli Lakha',
    "12823" => 'Hazro',
    "9844" => 'Hub Chowki',
    "13569" => 'Hujra Shah Muqeem',
    "1546" => 'Hunza',
    "30" => 'Hyderabad',
    "3" => 'Islamabad',
    "32" => 'Jacobabad',
    "11126" => 'Jahanian',
    "11026" => 'Jalalpur Jattan',
    "10484" => 'Jampur',
    "1178" => 'Jamshoro',
    "17731" => 'Jandola',
    "13706" => 'Jatoi',
    "8511" => 'Jauharabad',
    "1142" => 'Jhang',
    "19" => 'Jhelum',
    "9873" => 'Kabirwala',
    "9202" => 'Kaghan',
    "10279" => 'Kahror Pakka',
    "1750" => 'Kalat',
    "10416" => 'Kamalia',
    "10346" => 'Kamoki',
    "13611" => 'Kandiaro',
    "2" => 'Karachi',
    "9484" => 'Karak',
    "544" => 'Kasur',
    "8806" => 'Khairpur',
    "1685" => 'Khanewal',
    "10168" => 'Khanpur',
    "17732" => 'Khaplu',
    "1305" => 'Kharian',
    "12390" => 'Khipro',
    "8510" => 'Khushab',
    "1757" => 'Khuzdar',
    "1430" => 'Kohat',
    "17733" => 'Kohistan',
    "9749" => 'Kot Addu',
    "968" => 'Kotli',
    "8591" => 'Kotri',
    "1" => 'Lahore',
    "10205" => 'Lakki Marwat',
    "9837" => 'Lalamusa',
    "17734" => 'Landi Kotal',
    "586" => 'Larkana',
    "548" => 'Lasbela',
    "1661" => 'Layyah',
    "11406" => 'Liaquatpur',
    "9872" => 'Lodhran',
    "1742" => 'Loralai',
    "10482" => 'Lower Dir',
    "9422" => 'Mailsi',
    "1767" => 'Makran',
    "1384" => 'Malakand',
    "1496" => 'Mandi Bahauddin',
    "14350" => 'Mangla',
    "771" => 'Mansehra',
    "440" => 'Mardan',
    "8606" => 'Matiari',
    "14120" => 'Matli',
    "9636" => 'Mian Channu',
    "8310" => 'Mianwali',
    "13476" => 'Mingora',
    "17735" => 'Miran Shah',
    "1349" => 'Mirpur',
    "1558" => 'Mirpur Khas',
    "10893" => 'Mirpur Sakro',
    "13421" => 'Mitha Tiwana',
    "13603" => 'Moro',
    "15" => 'Multan',
    "8116" => 'Muridke',
    "36" => 'Murree',
    "977" => 'Muzaffarabad',
    "1722" => 'Muzaffargarh',
    "1687" => 'Nankana Sahib',
    "1258" => 'Naran',
    "541" => 'Narowal',
    "14962" => 'Nasar Ullah Khan Town',
    "1752" => 'Nasirabad',
    "8801" => 'Naushahro Feroze',
    "1704" => 'Nawabshah',
    "1741" => 'Neelum',
    "1424" => 'Nowshera',
    "470" => 'Okara',
    "979" => 'Others',
    "1528" => 'Others Azad Kashmir',
    "1529" => 'Others Balochistan',
    "1530" => 'Others Gilgit Baltistan',
    "1531" => 'Others Khyber Pakhtunkhwa',
    "1532" => 'Others Punjab',
    "1533" => 'Others Sindh',
    "1716" => 'Pakpattan',
    "17736" => 'Pallandri',
    "17737" => 'Parachinar',
    "17168" => 'Pasrur',
    "17" => 'Peshawar',
    "10678" => 'Pind Dadan Khan',
    "975" => 'Pindi Bhattian',
    "9508" => 'Pir Mahal',
    "17711" => 'Poonch',
    "13617" => 'Qazi Ahmed',
    "18" => 'Quetta',
    "40" => 'Rahim Yar Khan',
    "17707" => 'Raiwind',
    "14271" => 'Rajana',
    "9645" => 'Rajanpur',
    "17738" => 'Rato Dero',
    "9027" => 'Ratwal',
    "976" => 'Rawalkot',
    "41" => 'Rawalpindi',
    "1725" => 'Rohri',
    "9538" => 'Sadiqabad',
    "782" => 'Sahiwal',
    "13438" => 'Sakrand',
    "10632" => 'Samundri',
    "8609" => 'Sanghar',
    "8563" => 'Sangla Hill',
    "1034" => 'Sarai Alamgir',
    "778" => 'Sargodha',
    "8607" => 'Sehwan',
    "13211" => 'Shabqadar',
    "9029" => 'Shahdadpur',
    "8552" => 'Shahkot',
    "13614" => 'Shahpur Chakar',
    "12170" => 'Shakargarh',
    "17739" => 'Shangla',
    "13703" => 'Shehr Sultan',
    "44" => 'Sheikhupura',
    "13570" => 'Sher Garh',
    "8808" => 'Shikarpur',
    "10334" => 'Shorkot',
    "480" => 'Sialkot',
    "1744" => 'Sibi',
    "1545" => 'Skardu',
    "1745" => 'Sudhnoti',
    "14329" => 'Sujawal',
    "45" => 'Sukkur',
    "3094" => 'Swabi',
    "1506" => 'Swat',
    "12137" => 'Talagang',
    "9028" => 'Tando Adam',
    "11315" => 'Tando Allahyar',
    "11700" => 'Tando Bago',
    "13166" => 'Tando Muhammad Khan',
    "17740" => 'Tank',
    "464" => 'Taxila',
    "12439" => 'Tharparkar',
    "1729" => 'Thatta',
    "1658" => 'Toba Tek Singh',
    "17741" => 'Torkham',
    "12271" => 'Turbat',
    "17742" => 'Umarkot',
    "17743" => 'Upper Dir',
    "1432" => 'Vehari',
    "459" => 'Wah',
    "17744" => 'Wana',
    "1395" => 'Wazirabad',
    "1765" => 'Waziristan',
    "12504" => 'Yazman',
    "1739" => 'Zhob',
];

?>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get City Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="backdrop"></div>
    <div class="mosaic-loader">
        <div class="cell d-0"></div>
        <div class="cell d-1"></div>
        <div class="cell d-2"></div>
        <div class="cell d-3"></div>
        <div class="cell d-1"></div>
        <div class="cell d-2"></div>
        <div class="cell d-3"></div>
        <div class="cell d-4"></div>
        <div class="cell d-2"></div>
        <div class="cell d-3"></div>
        <div class="cell d-4"></div>
        <div class="cell d-5"></div>
        <div class="cell d-3"></div>
        <div class="cell d-4"></div>
        <div class="cell d-5"></div>
        <div class="cell d-6"></div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-6 mt-5">
                <div class="card">
                    <div class="card-header">
                        <h5>Get Data from Zameen</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12">
                                <select name="city_name" id="city_name" class="form-control">
                                    <option value="">Select City</option>
                                    <?php foreach ($cities as $index => $city) : ?>
                                        <option value="<?php echo $index ?>"><?php echo $city ?></option>
                                    <? endforeach ?>
                                </select>
                            </div>
                            <div class="col-12 select_1 mt-3"></div>
                            <div class="col-12 select_2 mt-3"></div>
                            <div class="col-12 select_3 mt-3"></div>
                            <div class="col-12 select_4 mt-3"></div>
                            <div class="col-12 select_5 mt-3"></div>
                        </div>
                    </div>
                    <!-- <div class="card-footer text-end">
                        <button class="btn btn-primary" id="get_data" type="button">Get Data</button>
                    </div> -->
                </div>
            </div>
            <div class="col-6 mt-5">
                <div class="card">
                    <div class="card-header">
                        <h5>Result</h5>
                    </div>
                    <div class="card-body">
                        <input type="hidden" name="parent_id" id="parent_id">
                        <div class="form-group">
                            <textarea name="result" id="result" cols="30" rows="10" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <button class="btn btn-primary" id="add_to_db" type="button">Add to Database</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
    <script>
        var addToDB = document.getElementById('add_to_db')
        var citySelect = document.getElementById('city_name')
        var result = document.getElementById('result')
        var parentId = document.getElementById('parent_id')
        citySelect.addEventListener('change', function() {
            var number = 1;
            var value = citySelect.value;
            var name = citySelect.options[citySelect.selectedIndex].text;
            var parent_id = 0;
            console.log(value)
            console.log(name)
            getData(value, name, parent_id, '.select_'+number, number)
        })
        $(document).on('change', '.place_name', function() {
            var number = this.dataset.number
            var value = this.value;
            var name = this.options[this.selectedIndex].text;
            var parent_id = parentId.value
            console.log(value)
            console.log(name)
            console.log(number)
            getData(value, name, parent_id, '.select_'+number, number)
        })

        function getData(value, name, parent_id, class_name, number) {
            number++;
            $.ajax({
                url: 'get_data_db.php',
                method: 'post',
                data: {
                    value: value,
                    name: name,
                    parent_id: parent_id
                },
                dataType: 'json',
                beforeSend: function() {
                    $('body').addClass('loader')
                },
                complete: function() {
                    $('body').removeClass('loader')
                },
                success: function(response) {
                    console.log(response)
                    if (response.status) {
                        result.innerText = ''
                        var html = '';
                        result.innerText = JSON.stringify(response.result)
                        parentId.value = value
                        html += '<select name="place_name" data-number='+number+' class="form-control place_name"><option value="">Select Place</option>';
                        response.result.forEach(function(place) {
                            html += '<option value = "' + place.index + '" > ' + place.place + ' </option>'
                        })
                        html += '</select>'
                        $(class_name).empty().append(html)
                        // alert('Data added to DB')
                    } else {
                        alert('Error');
                    }
                }
            })
        }

        addToDB.addEventListener('click', function() {
            var places = JSON.parse(result.value);
            var parent_id = parentId.value
            $.ajax({
                url: 'save_to_db.php',
                method: 'POST',
                data: {
                    parent_id: parent_id,
                    places: places
                },
                dataType: 'json',
                beforeSend: function() {
                    $('body').addClass('loader')
                },
                complete: function() {
                    $('body').removeClass('loader')
                },
                success: function(response) {
                    console.log(response)
                }
            })
        })
    </script>
</body>

</html>